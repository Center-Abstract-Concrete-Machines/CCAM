<script>
    class AnimationToggle extends HTMLElement {
        constructor() {
            super();
            const button = this.querySelector('button') as HTMLButtonElement;

            if (button) {
                // button clicked, fire event
                button.addEventListener('click', (e) => {
                    if (e.currentTarget instanceof HTMLButtonElement) {
                        let animationStatus =
                            localStorage.getItem('animation') || 'on';

                        // toggle
                        if (animationStatus === 'off') {
                            localStorage.setItem('animation', 'on');
                            location.reload();
                        } else if (animationStatus === 'on') {
                            localStorage.setItem('animation', 'off');
                            location.reload();
                        }
                    }
                });
            }
        }
    }

    customElements.define('animation-toggle', AnimationToggle);
</script>

<animation-toggle class="m-1">
    <button
        class="group relative h-9 w-9 rounded-md p-2 transition-all"
        id="animation-toggle"
        aria-label="Toggle Animations"
        title="Toggle Animations"
    >
        <svg
            id="tortoise"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            class="absolute start-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-pressed:scale-100 group-aria-pressed:opacity-100"
            ><path
                fill="currentColor"
                d="M19.31 5.6c-1.22-.04-2.43.9-2.81 2.4c-.5 2-.5 2-1.5 3c-2 2-5 3-11 4c-1 .16-1.5.5-2 1c2 0 4 0 2.5 1.5L3 19h3l2-2c2 1 3.33 1 5.33 0l.67 2h3l-1-3s1-4 2-5s1 0 2 0s2-1 2-2.5C22 8 22 7 20.5 6c-.35-.24-.76-.38-1.19-.4M9 6a6 6 0 0 0-6 6c0 .6.13 1.08.23 1.6c5.92-.98 9.06-2.01 10.7-3.66l.5-.5A6.007 6.007 0 0 0 9 6"
            ></path></svg
        >
        <svg
            id="rabbit"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            class="absolute start-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-[pressed=false]:scale-100 group-aria-[pressed=false]:opacity-100"
            ><g
                fill="none"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                ><path d="M13 16a3 3 0 0 1 2.24 5M18 12h.01"></path><path
                    d="M18 21h-8a4 4 0 0 1-4-4a7 7 0 0 1 7-7h.2L9.6 6.4a1 1 0 1 1 2.8-2.8L15.8 7h.2c3.3 0 6 2.7 6 6v1a2 2 0 0 1-2 2h-1a3 3 0 0 0-3 3"
                ></path><path
                    d="M20 8.54V4a2 2 0 1 0-4 0v3m-8.388 5.524a3 3 0 1 0-1.6 4.3"
                ></path></g
            ></svg
        >
    </button>
</animation-toggle>

<script is:inline>
    const animationButton = document.getElementById('animation-toggle');
    const animationStatus = localStorage.getItem('animation');

    function setButtonPresssed() {
        animationButton.setAttribute(
            'aria-pressed',
            animationStatus === 'off' ? 'false' : 'true'
        );
    }
    setButtonPresssed();

    document.addEventListener('astro:page-load', () => {
        const animationButton = document.getElementById('animation-toggle');
        const animationStatus = localStorage.getItem('animation');

        function setButtonPresssed() {
            animationButton.setAttribute(
                'aria-pressed',
                animationStatus === 'off' ? 'false' : 'true'
            );
        }
        setButtonPresssed();
    });
</script>
