<script>
    class ThemeToggle extends HTMLElement {
        constructor() {
            super();
            const button = this.querySelector('button') as HTMLButtonElement;

            if (button) {
                // button clicked, fire event
                button.addEventListener('click', (e) => {
                    if (e.currentTarget instanceof HTMLButtonElement) {
                        // isPressed === dark mode current on
                        let isPressed =
                            e.currentTarget.getAttribute('aria-pressed') ===
                            'true';

                        // invert isPressed
                        let themeChangeEvent = new CustomEvent('theme-change', {
                            detail: {
                                theme: isPressed ? 'light' : 'dark',
                            },
                        });
                        // dispatch event -> ThemeProvider.astro
                        document.dispatchEvent(themeChangeEvent);
                        // toggle the aria-pressed attribute
                        button.setAttribute('aria-pressed', String(!isPressed));
                    }
                });
            }
        }
    }

    customElements.define('theme-toggle', ThemeToggle);
</script>

<theme-toggle class="ms-2 sm:ms-4">
    <button
        type="button"
        id="toggle-theme"
        class="group relative h-9 w-9 rounded-md p-2 transition-all"
        aria-label="Toggle Dark Mode"
    >
        <!-- <svg
            id="sun-svg"
            class="absolute start-1/2 top-1/2 h-4 w-4 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-pressed:scale-100 group-aria-pressed:opacity-100"
            aria-hidden="true"
            focusable="false"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            ><path
                fill="currentColor"
                d="M11 5V1h2v4zm6.65 2.75l-1.375-1.375l2.8-2.875l1.4 1.425zM19 13v-2h4v2zm-8 10v-4h2v4zM6.35 7.7L3.5 4.925l1.425-1.4L7.75 6.35zm12.7 12.8l-2.775-2.875l1.35-1.35l2.85 2.75zM1 13v-2h4v2zm3.925 7.5l-1.4-1.425l2.8-2.8l.725.675l.725.7zM12 18q-2.5 0-4.25-1.75T6 12q0-2.5 1.75-4.25T12 6q2.5 0 4.25 1.75T18 12q0 2.5-1.75 4.25T12 18m0-2q1.65 0 2.825-1.175T16 12q0-1.65-1.175-2.825T12 8q-1.65 0-2.825 1.175T8 12q0 1.65 1.175 2.825T12 16m0-4"
            ></path></svg
        > -->
        <svg
            id="sun-svg"
            class="absolute start-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-pressed:scale-100 group-aria-pressed:opacity-100"
            aria-hidden="true"
            focusable="false"
            stroke-width="1.5"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path
                d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M22 12L23 12"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M12 2V1"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M12 23V22"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M20 20L19 19"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M20 4L19 5"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M4 20L5 19"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M4 4L5 5"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M1 12L2 12"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
        </svg>
        <svg
            id="moon-svg"
            class="absolute start-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-[pressed=false]:scale-100 group-aria-[pressed=false]:opacity-100"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 24 24"
            ><path
                fill="currentColor"
                d="M9.5 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T19.5 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T9.5 22q-1.325 0-2.588-.337T4.5 20.65Q6.825 19.3 8.163 17T9.5 12q0-2.7-1.338-5T4.5 3.35q1.15-.675 2.413-1.012T9.5 2"
            ></path></svg
        >

        <!-- <svg
            id="moon-svg"
            class="absolute start-1/2 top-1/2 h-4 w-4 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-[pressed=false]:scale-100 group-aria-[pressed=false]:opacity-100"
            aria-hidden="true"
            focusable="false"
            viewBox="0 0 24 24"
            ><path
                fill="currentColor"
                d="M12 21q-3.75 0-6.375-2.625T3 12q0-3.75 2.625-6.375T12 3q.35 0 .688.025t.662.075q-1.025.725-1.638 1.888T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q1.375 0 2.525-.613T20.9 10.65q.05.325.075.662T21 12q0 3.75-2.625 6.375T12 21Zm0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19Zm-.25-6.75Z"
            ></path></svg
        > -->

        <!-- <svg
            id="moon-svg"
            class="absolute start-1/2 top-1/2 h-4 w-4 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-[pressed=false]:scale-100 group-aria-[pressed=false]:opacity-100"
            aria-hidden="true"
            focusable="false"
            stroke-width="1.5"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <circle
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="1.5"></circle>
            <path
                d="M7.63262 3.06689C8.98567 3.35733 9.99999 4.56025 9.99999 6.00007C9.99999 7.65693 8.65685 9.00007 6.99999 9.00007C5.4512 9.00007 4.17653 7.82641 4.01685 6.31997"
                stroke="currentColor"
                stroke-width="1.5"></path>
            <path
                d="M22 13.0505C21.3647 12.4022 20.4793 12 19.5 12C17.567 12 16 13.567 16 15.5C16 17.2632 17.3039 18.7219 19 18.9646"
                stroke="currentColor"
                stroke-width="1.5"></path>
            <path
                d="M14.5 8.51L14.51 8.49889"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M10 17C11.1046 17 12 16.1046 12 15C12 13.8954 11.1046 13 10 13C8.89543 13 8 13.8954 8 15C8 16.1046 8.89543 17 10 17Z"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
        </svg> -->
    </button>
</theme-toggle>

{
    /* Inlined to avoid FOUC on full page load, runs once to set initial attribute */
}
<script is:inline>
    const button = document.getElementById('toggle-theme');

    function setButtonPresssed() {
        const bodyThemeIsDark =
            document.documentElement.classList.contains('dark');
        button.setAttribute('aria-pressed', String(bodyThemeIsDark));
    }
    setButtonPresssed();
</script>
